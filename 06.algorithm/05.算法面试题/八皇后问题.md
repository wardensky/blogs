# 八皇后问题



## 八皇后问题描述：

八皇后问题，是一个古老而著名的问题，是回溯算法的典型案例：在8X8格的国际象棋棋盘上摆放八个皇后，使其不能互相攻击，即任意两个皇后都不能处于同一行、同一列或同一斜线上，问有多少种摆法。

## 八皇后问题求解：

采用回溯算法，即从第一行开始，依次探查可以放置皇后的位置，若找到，则放置皇后，开始探查下一行；若该行没有位置可以放置皇后，则回溯至上一行，清除该行放置皇后的信息，从该行原本放置皇后的下一个位置开始探查可以放置皇后的位置。求所有解时，每找到一组解，就清除这一组解最后一个皇后的位置信息，开始探查该行另外一个可以放置皇后的位置，依次回溯求解。



## 代码实现

### 代码分析

这个代码对我来讲还是有点难度的，虽然对回溯法理解了，但看代码还是有难度，肯定是理解的不深刻。这个里面有几个难点要掌握的。

#### 用一个数组表示结果

#### 判断某一个位置能不能放的函数

这个函数说起来比较简单，就是判断某一个位置能不能放皇后，先放代码。
```
/**
 * 能否放一个皇后。
 *
 * @param k
 *            表示第几行
 * @param j
 *            表示第几个。
 * @return
 */
private boolean CanPlace(int k, int j) {
  System.out.println("call can place k=" + k + " j=" + j);

  for (int i = 1; i <= k; i++) {
    if (a[k - i] == j) {//j表示当前列
      System.out.println("  a[k - i] == j false " + j);
      return false;
    }
    if (a[k - i] == j - i) {
      System.out.println("  a[k - i] == j - i false " + (j - i));
      return false;
    }
    if (a[k - i] == j + i) {
      System.out.println("  a[k - i] == j + i false " + (j + i));
      return false;
    }

  }
  System.out.println("  true");
  return true;
}
```

这个代码被我改过了，为了分析其逻辑，加了一些输出。我把八皇后改成4皇后的时候，输出为：
```
m = 0
call can place k=0 j=0
  true
m = 1
call can place k=1 j=0
  a[k - i] == j false 0
call can place k=1 j=1
  a[k - i] == j - i false 0
call can place k=1 j=2
  true
m = 2
call can place k=2 j=0
  a[k - i] == j false 0
call can place k=2 j=1
  a[k - i] == j + i false 2
call can place k=2 j=2
  a[k - i] == j false 2
call can place k=2 j=3
  a[k - i] == j - i false 2
call can place k=1 j=3
  true
m = 2
call can place k=2 j=0
  a[k - i] == j false 0
call can place k=2 j=1
  true
m = 3
call can place k=3 j=0
  a[k - i] == j + i false 1
call can place k=3 j=1
  a[k - i] == j false 1
call can place k=3 j=2
  a[k - i] == j - i false 1
call can place k=3 j=3
  a[k - i] == j false 3
call can place k=2 j=2
  a[k - i] == j + i false 3
call can place k=2 j=3
  a[k - i] == j false 3
call can place k=0 j=1
  true
m = 1
call can place k=1 j=0
  a[k - i] == j + i false 1
call can place k=1 j=1
  a[k - i] == j false 1
call can place k=1 j=2
  a[k - i] == j - i false 1
call can place k=1 j=3
  true
m = 2
call can place k=2 j=0
  true
m = 3
call can place k=3 j=0
  a[k - i] == j false 0
call can place k=3 j=1
  a[k - i] == j - i false 0
call can place k=3 j=2
  true
八皇后的一组解为： 4
1302
*****************
call can place k=3 j=3
  a[k - i] == j false 3
call can place k=2 j=1
  a[k - i] == j false 1
call can place k=2 j=2
  a[k - i] == j + i false 3
call can place k=2 j=3
  a[k - i] == j false 3
call can place k=0 j=2
  true
m = 1
call can place k=1 j=0
  true
m = 2
call can place k=2 j=0
  a[k - i] == j false 0
call can place k=2 j=1
  a[k - i] == j - i false 0
call can place k=2 j=2
  a[k - i] == j false 2
call can place k=2 j=3
  true
m = 3
call can place k=3 j=0
  a[k - i] == j false 0
call can place k=3 j=1
  true
八皇后的一组解为： 4
2031
*****************
call can place k=3 j=2
  a[k - i] == j + i false 3
call can place k=3 j=3
  a[k - i] == j false 3
call can place k=1 j=1
  a[k - i] == j + i false 2
call can place k=1 j=2
  a[k - i] == j false 2
call can place k=1 j=3
  a[k - i] == j - i false 2
call can place k=0 j=3
  true
m = 1
call can place k=1 j=0
  true
m = 2
call can place k=2 j=0
  a[k - i] == j false 0
call can place k=2 j=1
  a[k - i] == j - i false 0
call can place k=2 j=2
  true
m = 3
call can place k=3 j=0
  a[k - i] == j false 0
call can place k=3 j=1
  a[k - i] == j + i false 2
call can place k=3 j=2
  a[k - i] == j false 2
call can place k=3 j=3
  a[k - i] == j - i false 2
call can place k=2 j=3
  a[k - i] == j false 3
call can place k=1 j=1
  true
m = 2
call can place k=2 j=0
  a[k - i] == j + i false 1
call can place k=2 j=1
  a[k - i] == j false 1
call can place k=2 j=2
  a[k - i] == j - i false 1
call can place k=2 j=3
  a[k - i] == j false 3
call can place k=1 j=2
  a[k - i] == j + i false 3
call can place k=1 j=3
  a[k - i] == j false 3
所有解的数量是：2

```


### 整体代码实现

```
package com.zch.blogs.algorithm.topic;

/**
 * ## 问题描述：
 *
 * 八皇后问题，是一个古老而著名的问题，是回溯算法的典型案例：在8X8格的国际象棋棋盘上摆放八个皇后，使其不能互相攻击，即任意两个皇后都不能处于同一行、同一列或同一斜线上，问有多少种摆法。
 *
 * ## 问题求解：
 *
 * 采用回溯算法，即从第一行开始，依次探查可以放置皇后的位置，若找到，则放置皇后，开始探查下一行；若该行没有位置可以放置皇后，则回溯至上一行，清除该行放置皇后的信息，从该行原本放置皇后的下一个位置开始探查可以放置皇后的位置。求所有解时，每找到一组解，就清除这一组解最后一个皇后的位置信息，开始探查该行另外一个可以放置皇后的位置，依次回溯求解。
 *
 * @Description
 * @author zch
 * @time 2018年9月24日 下午10:20:42
 *
 */
public class EightQueens {

	private int[] a = new int[8]; // 存储第i行皇后位于第a[i]列
	private static int count = 0;

	public static void main(String[] args) {
		EightQueens queen = new EightQueens();
		queen.Search(0);
		System.out.println("所有解的数量是：" + count);
	}

	public void Search(int m) {
		if (m >= 8) {
		//	System.out.println("八皇后的一组解为： " + m);
			count++;
			printResult();
		} else {
		//	System.out.println("m = " + m);
			for (int i = 0; i < 8; i++) {
				if (CanPlace(m, i)) {
					a[m] = i;
					Search(m + 1);
					a[m] = -10;
				}
			}
		}
	}

	private boolean CanPlace(int k, int j) {
		// System.out.println("call can place k=" + k + " j=" + j);
		for (int i = 1; i <= k; i++) {
			if ((a[k - i] == j) || (a[k - i] == j - i) || (a[k - i] == j + i)) { // 判断左上，右上，该列有没有其他皇后
				return false;
			}
		}
		return true;

	}


  	private void printResult() {
  		for (int i = 0; i < 8; i++) {
  			for (int j = 0; j < 8; j++) {
  				if (a[i] == j) {
  					System.out.print("Q");
  				} else {
  					System.out.print("0");
  				}
  			}
  			System.out.println();
  		}
  		System.out.println("*****************");
  	}

}

```

## 输出

```
Q0000000
0000Q000
0000000Q
00000Q00
00Q00000
000000Q0
0Q000000
000Q0000
*****************
Q0000000
00000Q00
0000000Q
00Q00000
000000Q0
000Q0000
0Q000000
0000Q000
*****************
Q0000000
000000Q0
000Q0000
00000Q00
0000000Q
0Q000000
0000Q000
00Q00000
*****************
Q0000000
000000Q0
0000Q000
0000000Q
0Q000000
000Q0000
00000Q00
00Q00000
*****************
0Q000000
000Q0000
00000Q00
0000000Q
00Q00000
Q0000000
000000Q0
0000Q000
*****************
0Q000000
0000Q000
000000Q0
Q0000000
00Q00000
0000000Q
00000Q00
000Q0000
*****************
0Q000000
0000Q000
000000Q0
000Q0000
Q0000000
0000000Q
00000Q00
00Q00000
*****************
0Q000000
00000Q00
Q0000000
000000Q0
000Q0000
0000000Q
00Q00000
0000Q000
*****************
0Q000000
00000Q00
0000000Q
00Q00000
Q0000000
000Q0000
000000Q0
0000Q000
*****************
0Q000000
000000Q0
00Q00000
00000Q00
0000000Q
0000Q000
Q0000000
000Q0000
*****************
0Q000000
000000Q0
0000Q000
0000000Q
Q0000000
000Q0000
00000Q00
00Q00000
*****************
0Q000000
0000000Q
00000Q00
Q0000000
00Q00000
0000Q000
000000Q0
000Q0000
*****************
00Q00000
Q0000000
000000Q0
0000Q000
0000000Q
0Q000000
000Q0000
00000Q00
*****************
00Q00000
0000Q000
0Q000000
0000000Q
Q0000000
000000Q0
000Q0000
00000Q00
*****************
00Q00000
0000Q000
0Q000000
0000000Q
00000Q00
000Q0000
000000Q0
Q0000000
*****************
00Q00000
0000Q000
000000Q0
Q0000000
000Q0000
0Q000000
0000000Q
00000Q00
*****************
00Q00000
0000Q000
0000000Q
000Q0000
Q0000000
000000Q0
0Q000000
00000Q00
*****************
00Q00000
00000Q00
0Q000000
0000Q000
0000000Q
Q0000000
000000Q0
000Q0000
*****************
00Q00000
00000Q00
0Q000000
000000Q0
Q0000000
000Q0000
0000000Q
0000Q000
*****************
00Q00000
00000Q00
0Q000000
000000Q0
0000Q000
Q0000000
0000000Q
000Q0000
*****************
00Q00000
00000Q00
000Q0000
Q0000000
0000000Q
0000Q000
000000Q0
0Q000000
*****************
00Q00000
00000Q00
000Q0000
0Q000000
0000000Q
0000Q000
000000Q0
Q0000000
*****************
00Q00000
00000Q00
0000000Q
Q0000000
000Q0000
000000Q0
0000Q000
0Q000000
*****************
00Q00000
00000Q00
0000000Q
Q0000000
0000Q000
000000Q0
0Q000000
000Q0000
*****************
00Q00000
00000Q00
0000000Q
0Q000000
000Q0000
Q0000000
000000Q0
0000Q000
*****************
00Q00000
000000Q0
0Q000000
0000000Q
0000Q000
Q0000000
000Q0000
00000Q00
*****************
00Q00000
000000Q0
0Q000000
0000000Q
00000Q00
000Q0000
Q0000000
0000Q000
*****************
00Q00000
0000000Q
000Q0000
000000Q0
Q0000000
00000Q00
0Q000000
0000Q000
*****************
000Q0000
Q0000000
0000Q000
0000000Q
0Q000000
000000Q0
00Q00000
00000Q00
*****************
000Q0000
Q0000000
0000Q000
0000000Q
00000Q00
00Q00000
000000Q0
0Q000000
*****************
000Q0000
0Q000000
0000Q000
0000000Q
00000Q00
Q0000000
00Q00000
000000Q0
*****************
000Q0000
0Q000000
000000Q0
00Q00000
00000Q00
0000000Q
Q0000000
0000Q000
*****************
000Q0000
0Q000000
000000Q0
00Q00000
00000Q00
0000000Q
0000Q000
Q0000000
*****************
000Q0000
0Q000000
000000Q0
0000Q000
Q0000000
0000000Q
00000Q00
00Q00000
*****************
000Q0000
0Q000000
0000000Q
0000Q000
000000Q0
Q0000000
00Q00000
00000Q00
*****************
000Q0000
0Q000000
0000000Q
00000Q00
Q0000000
00Q00000
0000Q000
000000Q0
*****************
000Q0000
00000Q00
Q0000000
0000Q000
0Q000000
0000000Q
00Q00000
000000Q0
*****************
000Q0000
00000Q00
0000000Q
0Q000000
000000Q0
Q0000000
00Q00000
0000Q000
*****************
000Q0000
00000Q00
0000000Q
00Q00000
Q0000000
000000Q0
0000Q000
0Q000000
*****************
000Q0000
000000Q0
Q0000000
0000000Q
0000Q000
0Q000000
00000Q00
00Q00000
*****************
000Q0000
000000Q0
00Q00000
0000000Q
0Q000000
0000Q000
Q0000000
00000Q00
*****************
000Q0000
000000Q0
0000Q000
0Q000000
00000Q00
Q0000000
00Q00000
0000000Q
*****************
000Q0000
000000Q0
0000Q000
00Q00000
Q0000000
00000Q00
0000000Q
0Q000000
*****************
000Q0000
0000000Q
Q0000000
00Q00000
00000Q00
0Q000000
000000Q0
0000Q000
*****************
000Q0000
0000000Q
Q0000000
0000Q000
000000Q0
0Q000000
00000Q00
00Q00000
*****************
000Q0000
0000000Q
0000Q000
00Q00000
Q0000000
000000Q0
0Q000000
00000Q00
*****************
0000Q000
Q0000000
000Q0000
00000Q00
0000000Q
0Q000000
000000Q0
00Q00000
*****************
0000Q000
Q0000000
0000000Q
000Q0000
0Q000000
000000Q0
00Q00000
00000Q00
*****************
0000Q000
Q0000000
0000000Q
00000Q00
00Q00000
000000Q0
0Q000000
000Q0000
*****************
0000Q000
0Q000000
000Q0000
00000Q00
0000000Q
00Q00000
Q0000000
000000Q0
*****************
0000Q000
0Q000000
000Q0000
000000Q0
00Q00000
0000000Q
00000Q00
Q0000000
*****************
0000Q000
0Q000000
00000Q00
Q0000000
000000Q0
000Q0000
0000000Q
00Q00000
*****************
0000Q000
0Q000000
0000000Q
Q0000000
000Q0000
000000Q0
00Q00000
00000Q00
*****************
0000Q000
00Q00000
Q0000000
00000Q00
0000000Q
0Q000000
000Q0000
000000Q0
*****************
0000Q000
00Q00000
Q0000000
000000Q0
0Q000000
0000000Q
00000Q00
000Q0000
*****************
0000Q000
00Q00000
0000000Q
000Q0000
000000Q0
Q0000000
00000Q00
0Q000000
*****************
0000Q000
000000Q0
Q0000000
00Q00000
0000000Q
00000Q00
000Q0000
0Q000000
*****************
0000Q000
000000Q0
Q0000000
000Q0000
0Q000000
0000000Q
00000Q00
00Q00000
*****************
0000Q000
000000Q0
0Q000000
000Q0000
0000000Q
Q0000000
00Q00000
00000Q00
*****************
0000Q000
000000Q0
0Q000000
00000Q00
00Q00000
Q0000000
000Q0000
0000000Q
*****************
0000Q000
000000Q0
0Q000000
00000Q00
00Q00000
Q0000000
0000000Q
000Q0000
*****************
0000Q000
000000Q0
000Q0000
Q0000000
00Q00000
0000000Q
00000Q00
0Q000000
*****************
0000Q000
0000000Q
000Q0000
Q0000000
00Q00000
00000Q00
0Q000000
000000Q0
*****************
0000Q000
0000000Q
000Q0000
Q0000000
000000Q0
0Q000000
00000Q00
00Q00000
*****************
00000Q00
Q0000000
0000Q000
0Q000000
0000000Q
00Q00000
000000Q0
000Q0000
*****************
00000Q00
0Q000000
000000Q0
Q0000000
00Q00000
0000Q000
0000000Q
000Q0000
*****************
00000Q00
0Q000000
000000Q0
Q0000000
000Q0000
0000000Q
0000Q000
00Q00000
*****************
00000Q00
00Q00000
Q0000000
000000Q0
0000Q000
0000000Q
0Q000000
000Q0000
*****************
00000Q00
00Q00000
Q0000000
0000000Q
000Q0000
0Q000000
000000Q0
0000Q000
*****************
00000Q00
00Q00000
Q0000000
0000000Q
0000Q000
0Q000000
000Q0000
000000Q0
*****************
00000Q00
00Q00000
0000Q000
000000Q0
Q0000000
000Q0000
0Q000000
0000000Q
*****************
00000Q00
00Q00000
0000Q000
0000000Q
Q0000000
000Q0000
0Q000000
000000Q0
*****************
00000Q00
00Q00000
000000Q0
0Q000000
000Q0000
0000000Q
Q0000000
0000Q000
*****************
00000Q00
00Q00000
000000Q0
0Q000000
0000000Q
0000Q000
Q0000000
000Q0000
*****************
00000Q00
00Q00000
000000Q0
000Q0000
Q0000000
0000000Q
0Q000000
0000Q000
*****************
00000Q00
000Q0000
Q0000000
0000Q000
0000000Q
0Q000000
000000Q0
00Q00000
*****************
00000Q00
000Q0000
0Q000000
0000000Q
0000Q000
000000Q0
Q0000000
00Q00000
*****************
00000Q00
000Q0000
000000Q0
Q0000000
00Q00000
0000Q000
0Q000000
0000000Q
*****************
00000Q00
000Q0000
000000Q0
Q0000000
0000000Q
0Q000000
0000Q000
00Q00000
*****************
00000Q00
0000000Q
0Q000000
000Q0000
Q0000000
000000Q0
0000Q000
00Q00000
*****************
000000Q0
Q0000000
00Q00000
0000000Q
00000Q00
000Q0000
0Q000000
0000Q000
*****************
000000Q0
0Q000000
000Q0000
Q0000000
0000000Q
0000Q000
00Q00000
00000Q00
*****************
000000Q0
0Q000000
00000Q00
00Q00000
Q0000000
000Q0000
0000000Q
0000Q000
*****************
000000Q0
00Q00000
Q0000000
00000Q00
0000000Q
0000Q000
0Q000000
000Q0000
*****************
000000Q0
00Q00000
0000000Q
0Q000000
0000Q000
Q0000000
00000Q00
000Q0000
*****************
000000Q0
000Q0000
0Q000000
0000Q000
0000000Q
Q0000000
00Q00000
00000Q00
*****************
000000Q0
000Q0000
0Q000000
0000000Q
00000Q00
Q0000000
00Q00000
0000Q000
*****************
000000Q0
0000Q000
00Q00000
Q0000000
00000Q00
0000000Q
0Q000000
000Q0000
*****************
0000000Q
0Q000000
000Q0000
Q0000000
000000Q0
0000Q000
00Q00000
00000Q00
*****************
0000000Q
0Q000000
0000Q000
00Q00000
Q0000000
000000Q0
000Q0000
00000Q00
*****************
0000000Q
00Q00000
Q0000000
00000Q00
0Q000000
0000Q000
000000Q0
000Q0000
*****************
0000000Q
000Q0000
Q0000000
00Q00000
00000Q00
0Q000000
000000Q0
0000Q000
*****************
所有解的数量是：92


````

## 参考


- [八皇后问题][1]
- [五大常用算法之四：回溯法][2]

[1]:https://www.jianshu.com/p/1ad1026c5a8b
[2]:http://www.cnblogs.com/steven_oyj/archive/2010/05/22/1741376.html
