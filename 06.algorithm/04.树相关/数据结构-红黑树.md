# 数据结构-红黑树


## 二叉查找树

二叉查找树（Binary Search Tree），（又：二叉搜索树，二叉排序树）它或者是一棵空树，或者是具有下列性质的二叉树： 若它的左子树不空，则左子树上所有结点的值均小于它的根结点的值； 若它的右子树不空，则右子树上所有结点的值均大于它的根结点的值； 它的左、右子树也分别为二叉排序树。

二叉查找树就是对二叉树进行了一个排序。

二叉排序树在通常情况下可以达到O(logN)的静态、动态操作的时间复杂度。但是存在一种特殊情况，即输入的数据本身就是有序的，这时二叉排序树退化成向量。这种情况下，就需要平衡二叉树了。


## 平衡二叉树（ AVL树）

平衡二叉树（Self-balancing binary search tree）又被称为AVL树（有别于AVL算法），且具有以下性质：它是一棵空树或它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树，同时，平衡二叉树必定是二叉搜索树，反之则不一定。平衡二叉树的常用实现方法有红黑树、AVL、替罪羊树、Treap、伸展树等。 最小二叉平衡树的节点的公式如下
```
F(n)=F(n-1)+F(n-2)+1
```
这个类似于一个递归的数列，可以参考Fibonacci(斐波那契)数列，1是根节点，F(n-1)是左子树的节点数量，F(n-2)是右子树的节点数量。

平衡二叉树通过旋转解决高度差的问题。树的旋转操作分为两种，左旋转和右旋转，这两种旋转是相对的。通过右旋或者左旋操作我们可以使一棵树继续保持平衡状态，并不会改变中序遍历的结果，但同时也要付出相应的代价。

![AVL树旋转](../images/blog_avl树旋转.png)



红黑树（Red Black Tree） 是一种自平衡二叉查找树，是在计算机科学中用到的一种数据结构，典型的用途是实现关联数组。
它是在1972年由Rudolf Bayer发明的，当时被称为平衡二叉B树（symmetric binary B-trees）。后来，在1978年被 Leo J. Guibas 和 Robert Sedgewick 修改为如今的“红黑树”。

红黑树和AVL树类似，都是在进行插入和删除操作时通过特定操作保持二叉查找树的平衡，从而获得较高的查找性能。

它虽然是复杂的，但它的最坏情况运行时间也是非常良好的，并且在实践中是高效的： 它可以在O(log n)时间内做查找，插入和删除，这里的n 是树中元素的数目。



比较常见的平衡二叉树是红黑树。红黑树是一种自平衡二叉查找树，是在计算机科学中用到的一种数据结构，典型的用途是实现关联数组。它是在1972年由Rudolf Bayer发明的，他称之为"对称二叉B树"，它现代的名字是在 Leo J. Guibas 和 Robert Sedgewick 于1978年写的一篇论文中获得的。它是复杂的，但它的操作有着良好的最坏情况运行时间，并且在实践中是高效的: 它可以在O(log n)时间内做查找，插入和删除，这里的n是树中元素的数目。

 红黑树就是一颗满足一定条件的，相对平衡的二叉树，是二叉树和AVL树的一种折中。
红黑树的添加删除操作同二叉树一样，但是当添加删除等操作后使红黑树失去了他的特性后，就需要进行旋转操作来恢复红黑树的特性。
红黑树需要满足以下几点性质：
1. 每个节点要么是红色，要么是黑色。
2. 根节点永远是黑色的。
3. 所有的叶节点都是空节点（即 null），并且是黑色的。
4. 每个红色节点的两个子节点都是黑色。（从每个叶子到根的路径上不会有两个连续的红色节点）
5. 从任一节点到其子树中每个叶子节点的路径都包含相同数量的黑色节点。（这就说明不能所有节点都是黑色）


从上面的性质 4 和 5来看，红色节点和黑色节点基本上是交替的出现，所以红黑树从根到叶子的最长的可能路径不多于最短的可能路径的两倍长，这样的结果是这个树大致上是平衡的。因为操作比如插入、删除和查找某个值的最坏情况时间都要求与树的高度成比例，这个在高度上的理论上限允许红黑树在最坏情况下都是高效的。
下图是一颗标准的红黑树

![](../images/blog_红黑树-1.png)

红黑树并不是高度的平衡树。所谓平衡树指的是一棵空树或它的左右两个子树的高度差的绝对值不超过1。红黑树放弃了高度平衡的特性而只追求部分平衡，这种特性降低了插入、删除时对树旋转的要求，从而提升了树的整体性能。而其他平衡树比如AVL树虽然查找性能为性能是O(logn)，但是为了维护其平衡特性，可能要在插入、删除操作时进行多次的旋转，产生比较大的消耗。

下面两张图是我从[网上](http://www.cnblogs.com/konck/p/7894499.html)找的红黑树插入后调整的算法，不深入写了。

![](../images/blog_红黑树-2.png)

![](../images/blog_红黑树-3.png)

## 参考

- [Java集合（4）一 红黑树、TreeMap与TreeSet（下）](http://www.cnblogs.com/konck/p/7894499.html)
- [二叉搜索树](https://baike.baidu.com/item/二叉搜索树)
- [图解集合7：红黑树概念、红黑树的插入及旋转操作详细解读](http://www.importnew.com/24930.html)
- [图解集合 8 : 红黑树的移除节点操作](http://www.importnew.com/25125.html)
